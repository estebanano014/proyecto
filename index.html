<!DOCTYPE html>
<html>
<head>
    <title>Escape del Hospital Abandonado 3D</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-extras@7.1.0/dist/aframe-extras.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script> <script src="js/game-logic.js"></script>
    <link rel="stylesheet" href="css/style.css"> <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }
        #message-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.5em;
            z-index: 1000;
            display: none; /* Inicialmente oculto */
        }
        #interaction-text {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            font-size: 1.1em;
            z-index: 999;
            display: none; /* Inicialmente oculto */
        }
    </style>
</head>
<body>
    <src="js/game-logic.js></src>
    <div id="message-overlay"></div>
    <div id="interaction-text"></div>

    <a-scene background="color: black" cursor="rayOrigin: mouse; fuse: false;" raycaster="objects: .collidable; far: 5">
        <a-assets>
            <a-asset-item id="room-model" src="models/room.glb"></a-asset-item>
            <a-asset-item id="door-model" src="models/door.glb"></a-asset-item>
            <a-asset-item id="key-model" src="models/key.glb"></a-asset-item>
            <a-asset-item id="table-model" src="models/table.glb"></a-asset-item>
            <a-asset-item id="file-cabinet-model" src="models/cabinet.glb"></a-asset-item>
            <img id="blood-texture" src="textures/blood_decal.png">
            <img id="damaged-wall-texture" src="textures/damaged_wall.jpg">
            <audio id="ambient-sound" src="sounds/hospital_ambient.mp3" preload="auto"></audio>
            <audio id="creak-sound" src="sounds/door_creak.mp3" preload="auto"></audio>
            <audio id="buzz-sound" src="sounds/light_buzz.mp3" preload="auto"></audio>
            <audio id="unlock-sound" src="sounds/unlock.mp3" preload="auto"></audio>
            <audio id="pickup-sound" src="sounds/pickup.mp3" preload="auto"></audio>
        </a-assets>

        <a-entity id="player"
                  camera="active: true"
                  look-controls="pointerLockEnabled: true"
                  wasd-controls="acceleration: 20"
                  position="0 1.6 0">
            <a-entity cursor="rayOrigin: cursor"
                      position="0 0 -1"
                      geometry="primitive: ring; radiusOuter: 0.008; radiusInner: 0.005"
                      material="color: white; shader: flat"></a-entity>
        </a-entity>

        <a-entity id="starting-room" position="0 0 0" visible="true">
            <a-gltf-model src="#room-model" scale="1 1 1"></a-gltf-model>
            <a-light type="point" intensity="0.5" position="0 2.5 -2" color="yellow" light-flicker="flickerRate: 100; minIntensity: 0.2; maxIntensity: 0.8;"></a-light>
            <a-light type="point" intensity="0.3" position="2 2.5 0" color="red" light-flicker="flickerRate: 150; minIntensity: 0.1; maxIntensity: 0.5;"></a-light>

            <a-entity id="door-to-hallway" gltf-model="#door-model" position="0 0 4" scale="1 1 1"
                      class="collidable clickable" data-target-room="hallway" door-controller="open: false; requiredItem: null;">
                <a-sound src="#creak-sound" on="click"></a-sound>
            </a-entity>
        </a-entity>

        <a-entity id="hallway" position="0 0 -10" visible="false">
             <a-gltf-model src="#room-model" scale="1 1 2"></a-gltf-model> <a-entity id="door-to-archives" gltf-model="#door-model" position="-2 0 -12" scale="1 1 1"
                      class="collidable clickable" data-target-room="archives-room" door-controller="open: false; requiredItem: null;">
                <a-sound src="#creak-sound" on="click"></a-sound>
            </a-entity>
            <a-entity id="door-to-surgery" gltf-model="#door-model" position="2 0 -12" scale="1 1 1"
                      class="collidable clickable" data-target-room="surgery-room" door-controller="open: false; requiredItem: null;">
                <a-sound src="#creak-sound" on="click"></a-sound>
            </a-entity>
        </a-entity>

        <a-entity id="archives-room" position="-10 0 -10" visible="false">
            <a-gltf-model src="#room-model" scale="1 1 1"></a-gltf-model>
            <a-gltf-model src="#file-cabinet-model" position="0 0 -2"></a-gltf-model>
            <a-plane id="code-puzzle" position="0 1.5 -1.9" width="1" height="0.5" color="#333" class="collidable clickable"
                     data-puzzle-status="locked" puzzle-controller>
                <a-text value="Puzle: RESUELVE" align="center" width="2" color="white"></a-text>
            </a-plane>
            <a-text id="puzzle-solution-code" value="CÃ“DIGO: 1785" position="0 1.2 -1.8" color="lime" visible="false"></a-text>
        </a-entity>

        <a-entity id="surgery-room" position="10 0 -10" visible="false">
            <a-gltf-model src="#room-model" scale="1 1 1"></a-gltf-model>
            <a-gltf-model src="#table-model" position="0 0 -1"></a-gltf-model>
            <a-image src="#blood-texture" position="0 0.01 -1" rotation="-90 0 0" width="1" height="1"></a-image>
            <a-entity id="main-key" gltf-model="#key-model" position="0.2 0.5 -1.2" scale="0.1 0.1 0.1"
                      class="collidable clickable" item-pickup="itemName: mainKey;">
                <a-sound src="#pickup-sound" on="click"></a-sound>
            </a-entity>
        </a-entity>

        <a-entity id="main-exit-door" gltf-model="#door-model" position="0 0 10" visible="false"
                  class="collidable clickable" door-controller="open: false; requiredItem: mainKey;">
            <a-text value="SALIDA PRINCIPAL" align="center" width="3" color="white" position="0 1 0.06"></a-text>
             <a-sound src="#unlock-sound" on="click"></a-sound>
             <a-sound src="#creak-sound" on="door-open"></a-sound>
        </a-entity>

        <a-entity sound="src: #ambient-sound; autoplay: true; loop: true; volume: 0.5"></a-entity>

    </a-scene>
</body>
</html>